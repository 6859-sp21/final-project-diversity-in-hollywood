<!DOCTYPE html>
<meta charset="utf-8">
<head>
  <title>Diversity in Hollywood</title>
  <link rel="shortcut icon" href="./images/favicon.ico" type="image/x-icon">  
  <script src="https://d3js.org/d3.v5.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/d3-legend/2.13.0/d3-legend.js"></script>
  <link href='https://fonts.googleapis.com/css?family=Didact Gothic' rel='stylesheet'>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">

  <style type="text/css">

    ul {
      background-color: #383838;
      list-style-type: none;
      display:flex;
      justify-content: center;
    }

    ul li {
      display: list-item;
    }

    li a {
      display: block;
      padding: 20px 20px;
      color: white;
    }

    li a:hover {
      background-color: #1a1a1a;
    }

    h1 { 
      color: 	#E6AB02; 
      font-size: 3rem;
      line-height: 1; 
      margin-left: 20px;
      margin-top: 20px;
      margin-bottom: 0px;
      text-align: left; 
    }

    h2 {
      color: white; 
      font-size: 1.2rem;
      line-height: 1; 
      margin-top: 5px;
      margin-left: 20px;
      text-align: left; 
    }

    body {
      font-family: 'Didact Gothic', sans-serif; 
      background-color: rgb(29, 28, 28);
    }

    #main {
      margin: auto;
      width: 70%;
      padding-bottom: 60px;
    }

    #slider-section {
      width: 1000px;
      margin: auto;
      padding-top: 30px;
    }

    #slider-container {
      position: relative;
      height:30px;
    }

    .slider {
      background-color: #E6AB02 !important;
    }

    .handle {
      height: 12px !important;
      width: 12px !important;
      border-color: black !important;
      background-color: black !important;
      border-radius: 10px;
    }

    #graph {
      /* so the graph doesn't go outside of the container on zoom */
      /* overflow: hidden; */
      cursor: pointer;
    }

    #legend {
      text-align: center;
    }

    .legendTitle {
      font-size: 18px;
    }

    .sources {
      color: white;
      font-size: 12px;
    }

    .caption {
      color: white;
      font-size: 15px;
    }

    #zoom {
      color: white;
      transform: translate(75px, 150px);
    }

    div.sidebar {	
      text-align: left;			
      width: 25%;
      height: 100vh;
      position: fixed;
      overflow: hidden;
      color: #E6AB02;		
      font: 18px "Didact Gothic";		
      background: #2C251E;	
      border: 0px;		
      padding: 30px;			
      pointer-events: none;			
    }

    body {
      display: flex;
      flex-direction: row;
    }

    text {
        font-family: 'Didact Gothic', sans-serif; 
    }

    #blurb {
        display: flex;
        flex-direction: column;
        width: 60%;
        padding: 10px;
    }

    .axis line{
        stroke: white;
    }

    .y-axis line{
      stroke: white;
      visibility: hidden;
    }

    .axis path{
        stroke: white;
    }

    .axis text{
      font-size: 20px;
      text-transform: lowercase;
      stroke: white;
    }

    .legendSize text {
      stroke: white;
      opacity: 100%;
    }

    #container {
      display: flex;
      flex-direction: column;
    }

    #heading {
      display: flex;
      flex-direction: row;
      width: 25%;
    }

    .nav-option {
      color: #7E5E29 !important;
      font-size: 24px;
      text-decoration: none !important;
    }

    .selected-nav-option {
      color: #E6AB02 !important;
      font-size: 26px;
      font-weight: 600;
      text-decoration: none !important;
    }

    .box {
      background-color:#383838;
    }

    input#search {
      -webkit-appearance: none;
      -moz-appearance: none;
      appearance: none;
      border-width: 0;
      font-size: 20px;
      outline: none;
      padding: 10px 100px;
      text-align: left;
      box-shadow: 0 0 0 2px #000000;
      border-radius: 5px;
    }

    input#search.dropdown {
      border-bottom-left-radius: 0;
      border-bottom-right-radius: 0;
    }

    #selector {
      position: fixed;
      box-shadow: 0 0 0 2px #000000;
      border-bottom-left-radius: 5px;
      border-bottom-right-radius: 5px;
      margin-top: 2px;
      max-height: 150px;
      overflow: auto;
    }

    #selector button {
      -webkit-appearance: none;
      -moz-appearance: none;
      appearance: none;
      outline: none;
      font-size: 20px;
      padding: 10px 20px; 
      cursor: pointer;
      border: none;
      display: block;
      background-color: #ffffff;
      margin: 0;
      border-radius: 5px;
      background-color: transparent;
      border-width: 0;
      width: 100%;
      text-align: left;
    }

    #selector button:hover {
      background-color: #f2f2f2;
    }

  </style>
</head>
<body>
    <!DOCTYPE html>
    <meta charset="utf-8">
    
    <!-- Load d3.js -->
    <script src="https://d3js.org/d3.v4.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    
    <!-- Create a div where the graph will take place -->
    <div class="row">
      <div class="p-4 col-sm-3" style="background-color: #383838;">
        <div style="position: fixed; ">
          <div id="heading">
            <img src="./images/popcorn.png" width="100" height="100">
            <div id="blurb">
              <h1>reception</h1>
              <h2>
                  By examining the top 30 grossing movies from each decade, we can explore race diversity vs. metrics of reception.
                  Hover over circles to see more information about individual movies.
              </h2>
              <!-- <div class="sources">
                <i>
                  Adapted from: <a href="https://www.d3-graph-gallery.com/graph/scatter_basic.html">D3 Scatterplot Tutorial</a> <br>
                  Data from: <a href="https://www.kaggle.com/carolzhangdc/imdb-5000-movie-dataset">IMDB Top 5000 Dataset</a>, 
                  <a href="https://www.nndb.com/">NNDB</a>,
                  Image from: <a href="https://favpng.com/png_view/popcorn-popcorn-icon-design-icon-png/UP1B5p7K">source</a>
                </i>
              </div> -->
            </div>
          </div>
          <div class="p-3 explore-section">
            <div class="nav-options">
              <a class="nav-option" href="oscars.html">awards</a>
              <br/>
              <a href="reception.html" class="selected-nav-option">reception</a>
              <br/>
              <a href="index.html" class="nav-option">back to home</a>
            </div>
          </div>
        </div>
      </div>
      <div class="col-sm-9">
        <div id="main">
          <div id="legend"></div>
          <div id="graph"></div>
        </div>   
        <div id="comparison" style="display:flex; flex-direction: column;">
          <input id="search" type="text" placeholder="search..">
          <br></br>
          <br></br>
          <br></br>
          <div style="display:flex; flex-direction: row;">
            <div id="first" class="box"></div>
            <div id="second" class="box"></div> 
          </div>
        </div>
      </div>
    </div>
   
    
  
  <!-- JAVASCRIPT -->
  <script>

    // sets dimensions
    var margin = {top: 10, right: 60, bottom: 60, left: 60},
        width = 1100 - margin.left - margin.right,
        height = 900 - margin.top - margin.bottom;
    
    var legendWidth = 300;
    var legendHeight = 150;

    // sets constants
    var goldColor = "#E6AB02"
    
    // defines graph svg
    var svg = d3.select("#graph")
      .append("svg")
        .attr("width", width + margin.left + margin.right)
        .attr("height", height + margin.top + margin.bottom)
      .append("g")
        .attr("transform",
              "translate(" + margin.left + "," + margin.top + ")");
    
    // defines tooltip div
    var metadataSidebar = d3.select("body").append("div")	
        .attr("class", "sidebar")				
        .style("opacity", 0);
    
    // defines comparison viz svg
    var comp = d3.select("#comparison")
        .append("div")

    // x-position scale
    var x = d3.scaleLinear()
        .domain([0, 1])
        .range([ 0, width ]);
    svg.append("g")
        .attr("transform", "translate(0," + height + ")")
        .attr("class", "axis")
        .call(d3.axisBottom(x))
        .call(g => g.select(".domain").remove());

    svg.append("text")             
        .attr("transform",
            "translate(" + (width/2) + " ," + 
                        (height + margin.top + 50) + ")")
        .style("text-anchor", "middle")
        .style("stroke", "white")
        .style("font-size", "20px")
        .text("% white cast");

    // y-position scale
    var decades = ["1920s", "1930s", "1940s", "1950s", "1960s", "1970s", "1980s", "1990s", "2000s", "2010s"].reverse()
    var y = d3.scaleBand()
        .padding(0.4)
        .domain(decades)
        .range([ height, 0 ]);
    svg.append("g")
        .attr("class", "axis y-axis")
        .call(d3.axisLeft(y))
        .call(g => g.select(".domain").remove());
    
    // background bars
    svg.selectAll("bar")
      .data(decades)
        .enter()
          .append("rect")
            .style("fill", "#383838")
            .attr("rx", 6)
            .attr("ry", 6)
            .attr("x", 0)
            .attr("width", x(1))
            .attr("y", function(d) { return y(d); })
            .attr("height", y.bandwidth())
    // horizontal lines through background bars
    svg.selectAll("bar")
      .data(decades)
        .enter()
          .append('line')
            .style("stroke", "white")
            .style("stroke-width", 1)
            .style("opacity", 0.15)
            .attr("x1", 0)
            .attr("y1", function(d) {return y(d) + y.bandwidth() / 2})
            .attr("x2", x(1))
            .attr("y2", function(d) {return y(d) + y.bandwidth() / 2})
    // vertical lines through background bars
    var percentWhiteTicks = [0, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9, 1]
    svg.selectAll("bar")
      .data(percentWhiteTicks)
        .enter()
          .append('line')
            .style("stroke", "rgb(29, 28, 28)")
            .style("stroke-width", 2.5)
            .attr("x1", d => x(d))
            .attr("y1", 0)
            .attr("x2", d => x(d))
            .attr("y2", height)
    
    function nFormatter(num, digits) {
      var si = [
        { value: 1, symbol: "" },
        { value: 1E3, symbol: "k" },
        { value: 1E6, symbol: "M" },
        { value: 1E9, symbol: "B" },
        { value: 1E12, symbol: "T" },
        { value: 1E15, symbol: "P" },
        { value: 1E18, symbol: "E" }
      ];
      var rx = /\.0+$|(\.[0-9]*[1-9])0+$/;
      var i;
      for (i = si.length - 1; i > 0; i--) {
        if (num >= si[i].value) {
          break;
        }
      }
      return (num / si[i].value).toFixed(digits).replace(rx, "$1") + si[i].symbol;
    }

    // radius scale
    var rScale = d3.scaleLinear()
        .domain([0, 1900000000]) // hardset from worldwide gross income max
        .range([2, 20]);

    // size-based legend for revenue
    var legendSvg = d3.select("#legend")
        .append("svg")
            .attr("width", legendWidth)
            .attr("height", legendHeight);
           
    legendSvg.append("g")
        .attr("class", "legendSize")
        .attr("transform", "translate(0, 50)")
        .style("fill", goldColor);

    var legendSize = d3.legendSize()
        .scale(rScale)
        .shape('circle')
        .shapePadding(60)
        .labelFormat(d => nFormatter(d,1))
        .labelOffset(20)
        .title('adjusted lifetime revenue ($)')
        .orient('horizontal');
    
    legendSvg.select(".legendSize")
        .call(legendSize);

    // function to show each metric of the comparison viz
    var showMetric = function(input, valueStr, name, metric){
        const width = 500;
        const height = 150;

        //create an svg with width and height
        var id = "#";
        var svg = d3.select(id.concat(name))
          .append('svg')
          .attr("width", width)
          .attr("height", height)
        
        svg.append("text")
          .text(metric + ": " + valueStr)
          .style("stroke", "white")
          .style("fill", "white")
          .attr("transform", "translate(0,50)");

        var numRows = 1;
        var numCols = 10;

        //x and y axis scales
        var y = d3.scaleBand()
          .range([0,250])
          .domain(d3.range(numRows));

        var x = d3.scaleBand()
          .range([0, 250])
          .domain(d3.range(numCols));

        // the data is just an array of numbers for each cell in the grid
        data = d3.range(10);

        var icon = svg.append("defs")
          .append("g")
          .attr("id", metric);

        if (metric === "metascore") { // star icon for metascore
          icon.append("path")
            .attr("d", "m510.652344 185.902344c-3.351563-10.367188-12.546875-17.730469-23.425782-18.710938l-147.773437-13.417968-58.433594-136.769532c-4.308593-10.023437-14.121093-16.511718-25.023437-16.511718s-20.714844 6.488281-25.023438 16.535156l-58.433594 136.746094-147.796874 13.417968c-10.859376 1.003906-20.03125 8.34375-23.402344 18.710938-3.371094 10.367187-.257813 21.738281 7.957031 28.90625l111.699219 97.960937-32.9375 145.089844c-2.410156 10.667969 1.730468 21.695313 10.582031 28.09375 4.757813 3.4375 10.324219 5.1875 15.9375 5.1875 4.839844 0 9.640625-1.304687 13.949219-3.882813l127.46875-76.183593 127.421875 76.183593c9.324219 5.609376 21.078125 5.097657 29.910156-1.304687 8.855469-6.417969 12.992187-17.449219 10.582031-28.09375l-32.9375-145.089844 111.699219-97.941406c8.214844-7.1875 11.351563-18.539063 7.980469-28.925781zm0 0")
            .attr("transform", "translate(0,0) scale(.05)");
        } else if (metric === "race") { // person icon for race
          icon.append("circle")
            .attr("cx", 26.686)
            .attr("cy", 4.507)
            .attr("r", 4.507)
            .attr("transform", "translate(0,0) scale(.5)");
          icon.append("path")
            .attr("d", "M28.256,11.163c-1.123-0.228-2.344-0.218-3.447,0.042c-7.493,0.878-9.926,9.551-9.239,16.164    c0.298,2.859,4.805,2.889,4.504,0c-0.25-2.41-0.143-6.047,1.138-8.632c0,3.142,0,6.284,0,9.425c0,0.111,0.011,0.215,0.016,0.322    c-0.003,0.051-0.015,0.094-0.015,0.146c0,7.479-0.013,14.955-0.322,22.428c-0.137,3.322,5.014,3.309,5.15,0    c0.242-5.857,0.303-11.717,0.317-17.578c0.244,0.016,0.488,0.016,0.732,0.002c0.015,5.861,0.074,11.721,0.314,17.576    c0.137,3.309,5.288,3.322,5.15,0c-0.309-7.473-0.32-14.949-0.32-22.428c0-0.232-0.031-0.443-0.078-0.646    c-0.007-3.247-0.131-6.497-0.093-9.742c1.534,2.597,1.674,6.558,1.408,9.125c-0.302,2.887,4.206,2.858,4.504,0    C38.678,20.617,36.128,11.719,28.256,11.163z")
            .attr("transform", "translate(0,0) scale(0.5)")
            // .attr("fill", goldColor);
        } else { // dollar sign icon for revenue, budget
          icon.append("path")
            .attr("d", "M309.43,219.944c-19-10.5-39.2-18.5-59.2-26.8c-11.6-4.8-22.7-10.4-32.5-18.2c-19.3-15.4-15.6-40.4,7-50.3   c6.4-2.8,13.1-3.7,19.9-4.1c26.2-1.4,51.1,3.4,74.8,14.8c11.8,5.7,15.7,3.9,19.7-8.4c4.2-13,7.7-26.2,11.6-39.3   c2.6-8.8-0.6-14.6-8.9-18.3c-15.2-6.7-30.8-11.5-47.2-14.1c-21.4-3.3-21.4-3.4-21.5-24.9c-0.1-30.3-0.1-30.3-30.5-30.3   c-4.4,0-8.8-0.1-13.2,0c-14.2,0.4-16.6,2.9-17,17.2c-0.2,6.4,0,12.8-0.1,19.3c-0.1,19-0.2,18.7-18.4,25.3c-44,16-71.2,46-74.1,94   c-2.6,42.5,19.6,71.2,54.5,92.1c21.5,12.9,45.3,20.5,68.1,30.6c8.9,3.9,17.4,8.4,24.8,14.6c21.9,18.1,17.9,48.2-8.1,59.6   c-13.9,6.1-28.6,7.6-43.7,5.7c-23.3-2.9-45.6-9-66.6-19.9c-12.3-6.4-15.9-4.7-20.1,8.6c-3.6,11.5-6.8,23.1-10,34.7   c-4.3,15.6-2.7,19.3,12.2,26.6c19,9.2,39.3,13.9,60,17.2c16.2,2.6,16.7,3.3,16.9,20.1c0.1,7.6,0.1,15.3,0.2,22.9   c0.1,9.6,4.7,15.2,14.6,15.4c11.2,0.2,22.5,0.2,33.7-0.1c9.2-0.2,13.9-5.2,13.9-14.5c0-10.4,0.5-20.9,0.1-31.3   c-0.5-10.6,4.1-16,14.3-18.8c23.5-6.4,43.5-19,58.9-37.8C386.33,329.544,370.03,253.444,309.43,219.944z")
            // .attr("fill", goldColor)
            .attr("transform", "translate(0,0) scale(0.05)");
        }

        //container to hold the grid
        var container = svg.append("g")
          .attr("transform", "translate(120,120)");

        container.selectAll("use")
            .data(data)
            .enter().append("use")
            .attr("xlink:href", id.concat(metric))
            .attr("id", function(d){return "id"+d;})
            .attr('x', function(d){return x(d%numCols);})
            .attr('y', function(d){return y(Math.floor(d/numCols));})
            .attr('fill', function(d){return d < input ? goldColor : "#7e5d02";});
    }

    // data input for the bubble plot
    d3.csv("./datasets/movie_distributions_top_1000_gross.csv", function(all_data) {
      // filter out top 50 per decade
      var data = []
      for (let i = 0; i < decades.length; i++) {
        var decadePrefix = decades[i].substring(0,3)
        var moviesInDecade = all_data.filter(d => d.year.substring(0,3) == decadePrefix)
        // sort movies by gross
        moviesInDecade.sort((a,b) => (a.adjusted_lifetime_gross < b.adjusted_lifetime_gross) ? 1 : -1)
        data.push(...moviesInDecade.slice(0,30)) // take top 30 movies
      }
      console.log('data', data, data.length)
      

      function getHtmlForSidebar(data) {
        // console.log(data.budget, intToString(data.worlwide_gross_income))
        // genre, budget, metascore, gross worldwide / us, percent distribution 
        var header = "<h3>" + data.original_title + " (" + data.year + ")" + "</h3>"
        var genre = "<div>Genre: " + data.genre + "</div>"
        var budget = "<div>Budget: " + nFormatter(data.budget,1) + "</div>"
        var metascore = "<div>IMDB metascore: " + data.metascore + "/100</div>"
        var gross = "<div>Worldwide gross revenue: " + nFormatter(data.adjusted_lifetime_gross, 1) + "</div>"
        var breaks = "<br><br>"
        var diversityText = "<div> Of the 15 most important actors in the film, the race distribution was: </div>"
        var white = "<div>" + Math.round(data.percent_white * 1000) / 10 + "% white"
        var black = "<div>" + Math.round(data.percent_black * 1000) / 10 + "% black"
        var hispanic = "<div>" + Math.round(data.percent_hispanic * 1000) / 10 + "% hispanic"
        var asian = "<div>" + Math.round(data.percent_asian * 1000) / 10 + "% asian"
        var other = "<div>" + Math.round(data.percent_other * 1000) / 10 + "% other"

        return header + genre + budget + metascore + gross + breaks + diversityText + white + black + hispanic + asian + other
      }

      // parse the data
      for (i = 0; i < data.length; i++) {
          data[i].budget = parseFloat(data[i].budget.replace('$', ''));
          data[i].usa_gross_income = parseFloat(data[i].usa_gross_income.replace('$', ''));
          data[i].adjusted_lifetime_gross = parseFloat(data[i].adjusted_lifetime_gross.substring(1,).replace(/,/g, ''));
      }

      // add scatterplot dots
      var node = svg.append('g')
      .selectAll("circle")
      .data(data)
      .enter()
      .append("circle")
        .attr("cx", d => x(d.percent_white))
        .attr("cy", d => {return y(d.year.substring(0,3) + "0s") + y.bandwidth() / 2})
        .attr("r", d => rScale(parseFloat(d.adjusted_lifetime_gross)))
        .style("fill", goldColor)
        .style("stroke", "#383838")
        .style("stroke-width", 1.5)
        .on("mouseover", function(d) {		
            metadataSidebar.transition()		
                .duration(200)		
                .style("opacity", 1);		
            metadataSidebar.html(
              getHtmlForSidebar(d)
            )
              .style("left", "0px")		
              .style("top", "0px");	
        })					
        .on("mouseout", function(d) {		
            metadataSidebar.transition()		
                .duration(200)		
                .style("opacity", 0);	
        });
        
      // physics for dots along the line
      // Features of the forces applied to the nodes:
      var simulation = d3.forceSimulation()
          .force('x', d3.forceX().x(function(d) {
            // return xCenter[d.category];
            return x(d.percent_white);
          }).strength(0.4))
          .force('y', d3.forceY().y(function(d) {
            return y(d.year.substring(0,3) + "0s") + y.bandwidth() / 2;
          }).strength(0.4))
          .force('charge', d3.forceManyBody().strength(3))
          .force('collision', d3.forceCollide().radius(function(d) {
            return rScale(parseFloat(d.adjusted_lifetime_gross));
          }))

      // Apply these forces to the nodes and update their positions.
      // Once the force algorithm is happy with positions ('alpha' value is low enough), simulations will stop.
      simulation
          .nodes(data)
          .on("tick", function(d){
            node
                .attr("cx", function(d){ return d.x; })
                .attr("cy", function(d){ return d.y; })
          }); 

      function searchMovies() {
        return function() {
          console.log("inside searchMovies");
          let elem = document.getElementById("search");
          console.log(elem.value);
          let selector = document.getElementById("selector");
          // Check if input is empty
          if (elem.value.trim() !== "") {
            elem.classList.add("dropdown"); // Add dropdown class (for the CSS border-radius)
            // If the selector div element does not exist, create it
            if (selector == null) {
                selector = document.createElement("div");
                selector.id = "selector";
                elem.parentNode.appendChild(selector);
                // Position it below the input element
                selector.style.left = elem.getBoundingClientRect().left + "px";
                selector.style.top = elem.getBoundingClientRect().bottom + "px";
                selector.style.width = elem.getBoundingClientRect().width + "px";
            }
            // Clear everything before new search
            selector.innerHTML = "";
            // Variable if result is empty
            let empty = true;
            for (let i = 0; i < all_data.length; i++) {
                  // If exists, create an item (button)
                  let str = all_data[i].original_title.toLowerCase();
                  if (str.indexOf(elem.value) !== -1) {
                      let opt = document.createElement("button");
                      opt.onclick = function() {
                        window.search.classList.remove("dropdown");
                        window.search.value = opt.innerHTML;
                        opt.parentNode.parentNode.removeChild(opt.parentNode);
                        
                        var svg1 = d3.select("#first");
                        var svg2 = d3.select("#second");
                        svg1.selectAll('*').remove();
                        svg2.selectAll('*').remove();

                        console.log("im here with the new movie: ", all_data[i].original_title);
                        var selectedMovie = all_data[i];
                        selectedScore = Math.round(selectedMovie.metascore / 10.0); // score 100% ==> scale on 10 stars
                        selectedScoreVal = nFormatter(selectedMovie.metascore, 1) + " / 100";
                        selectedRevenue = selectedMovie.adjusted_lifetime_gross;
                        selectedRevenueVal = "$" + nFormatter(selectedMovie.adjusted_lifetime_gross, 1);
                        selectedBudget = selectedMovie.budget;
                        selectedBudgetVal = "$" + nFormatter(selectedMovie.budget, 1);
                        selectedRace = (1-selectedMovie.percent_white)*100
                        selectedRaceVal = nFormatter((1 - selectedMovie.percent_white)*100, 1) + "%";

                        var compMovies = data.filter(d => d.year == selectedMovie.year);
                        compScore = Math.round((compMovies.reduce((total, i) => total + parseInt(i.metascore), 0) / compMovies.length) / 10.0);
                        compScoreVal = nFormatter(compMovies.reduce((total, i) => total + parseInt(i.metascore), 0) / compMovies.length, 1) + " / 100";
                        compRevenue = compMovies.reduce((total, i) => total + parseFloat(i.adjusted_lifetime_gross), 0) / compMovies.length;
                        compRevenueVal = "$" + nFormatter(compMovies.reduce((total, i) => total + parseFloat(i.adjusted_lifetime_gross), 0) / compMovies.length, 1);
                        compBudget = compMovies.reduce((total, i) => total + parseFloat(i.budget), 0) / compMovies.length;
                        compBudgetVal = "$" + nFormatter(compMovies.reduce((total, i) => total + parseInt(i.budget), 0) / compMovies.length, 1);
                        compRace = (1 - compMovies.reduce((total, i) => total + parseFloat(i.percent_white), 0) / compMovies.length)*100;
                        compRaceVal = nFormatter((1-compMovies.reduce((total, i) => total + parseFloat(i.percent_white), 0) / compMovies.length) * 100, 1) + "%";

                        moneyVals = [selectedBudget, compBudget, selectedRevenue, compRevenue]
                        var moneyScale = d3.scaleQuantize()
                            .domain([0, Math.max.apply(null, moneyVals)])
                            .range([1,2,3,4,5,6,7,8,9,10]);

                        showMetric(selectedScore, selectedScoreVal, "first", "metascore");
                        showMetric(moneyScale(selectedRevenue), selectedRevenueVal, "first", "revenue");
                        showMetric(moneyScale(selectedBudget), selectedBudgetVal, "first", "budget");
                        showMetric(Math.round(selectedRace/10), selectedRaceVal, "first", "race")

                        showMetric(compScore, compScoreVal, "second", "metascore");
                        showMetric(moneyScale(compRevenue), compRevenueVal, "second", "revenue");
                        showMetric(moneyScale(compBudget), compBudgetVal,  "second", "budget");
                        showMetric(Math.round(compRace/10), compRaceVal, "second", "race");
                      };
                      opt.innerHTML = all_data[i].original_title;
                      selector.appendChild(opt);
                      empty = false;
                  }
              }
              // If result is empty, display a disabled button with text
              if (empty == true) {
                  let opt = document.createElement("button");
                  opt.disabled = true;
                  opt.innerHTML = "No results";
                  selector.appendChild(opt);
              }
          }
          // Remove selector element if input is empty
          else {
              if (selector !== null) {
                  selector.parentNode.removeChild(selector);
                  elem.classList.remove("dropdown");
              }
          }
        }
      }
    
      document.getElementById("search").onkeyup = searchMovies();
    })
    </script>
</body>